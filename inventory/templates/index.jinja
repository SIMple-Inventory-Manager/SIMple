{% extends 'base-template.jinja' %}
{% block content %}
    <div class="container" style="float: contour;" align="center">
    <h3 align="center">Inventory</h3>
    <hr>
        <div class="form-horizontal" title="Item list">
        {% if not summary %}
            <h3 align="center" class="font-weight-light">No Items</h3>
        {% else %}
        <div id="item-buttons">

            {% for product in products %}
                {% set prod_num = products.index(product)+1 %}

                {# Set data we may need into easy-to-use variables #}
                {% set prod_id        = product[0] %}
                {% set prod_name      = product[1] %}
                {% set prod_upc       = product[2] %}
                {% set prod_qty       = product[3]|int %}
                {% set quick_take_qty = product[4]|int %}
                {% set min_qty        = product[5]|int %}
                {% set reorder_qty    = product[6]|int %}
                {% set location       = product[7] %}
                {% set categories     = product[8] %}
                {% set been_reordered = product[9]|int %}

                {% if prod_qty >= min_qty %}
                    {% set need_reorder = "" %}
                    {% set reorder_icon = ""%}
                    {% set state="stocked" %}
                    {% set reorder_toggle = 0 %}
                    {% set restock_toggle = 0%}
                {% elif prod_qty < min_qty %}
                    {% if prod_qty == 0 %}
                        {% set state="out" %}
                    {% elif prod_qty <= (min_qty/2) %}
                        {% set state="warning" %}
                    {% else %}
                        {% set state="low" %}
                    {% endif %}
                {% endif %}
                {% if state in ["low", "out", "warning"] %}
                    {% if been_reordered == 0 %}
                        {% set need_reordered = "Please Reorder" %}
                        {% set reorder_toggle = 1 %}
                    {% elif been_reordered == 1 %}
                        {% set need_reordered = "Reorder In Process" %}
                        {% set reorder_icon = "<img name='reorder' id='reorder-icon' src=" + url_for('static', filename='reordered.png') +">" %}
                        {% set reorder_toggle = 0 %}
                        {% set restock_toggle = 1 %}
                    {% endif %}
                {% endif %}


                <button class="btn item-btn {{ state }}" id="btn-{{prod_id}}" data-toggle="modal" data-target="#edit_{{ prod_id }}">{{ prod_name }}<br/> ({{ prod_qty }})<br>{{ reorder_icon }}</button>

                <div id="edit_{{ prod_id }}" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="trans_message" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body"><h3>{{ prod_name }}</h3></div>
                        <div class="modal-body"><h4>On hand: {{ prod_qty }} - Reorder Amount: {{ reorder_qty }}</h4></div>
                        <div class="modal-body">{{ need_reordered }} </div>
                        <div class="modal-body">
                            <a href="{{ url_for('quick_change', product=prod_id, type='subtract', qty=1) }}">
                                <button name="single-quick" class="btn btn-danger" align="left" value="subtract-one">Take 1</button>
                            </a>
                            <a href="{{ url_for('quick_change', product=prod_id, type='add', qty=1) }}">
                                <button name="single-quick" class="btn btn-success" align="right" value="add-one">Add 1</button>
                            </a>
                            {% if quick_take_qty > 1 %}
                            <br/>
                                <a href="{{ url_for('quick_change', product=prod_id, type='subtract', qty=quick_take_qty ) }}">
                                <button name="single-quick" class="btn btn-danger" align="left" value="subtract-quick-take">Take {{quick_take_qty}}</button>
                            </a>
                            <a href="{{ url_for('quick_change', product=prod_id, type='add', qty=quick_take_qty) }}">
                                <button name="single-quick" class="btn btn-success" align="right" value="add-quick-take">Add {{ quick_take_qty }}</button>
                            </a>
                            <br/>
                            {% else %}
                            <br>
                            {% endif %}
                            <a href="javascript:enable_custom({{prod_id}}, 'subtract')" id="custom-subtract-{{prod_id}}">
                                <button name="single-quick" class="btn btn-danger" align="left" value="subtract-custom">Take Other</button>
                            </a>
                            <a href="javascript:enable_custom({{prod_id}}, 'add')" id="custom-subtract-{{prod_id}}">
                                <button name="single-quick" class="btn btn-success" align="right" value="add-custom">Add other</button>
                            </a>
                        </div>
                        <form action="{{ url_for('quick_change', type='form') }}" method="POST">
                        <input name="product_id" hidden value="{{ prod_id }}">
                        <div id="display-{{ prod_id }}"></div>
                        </form>
                        <div class="modal-body custom-keypad" id="custom-insert-{{prod_id}}">

                        </div>
                        <div class="modal-body">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            {% if reorder_toggle == 1 %}
                                <a href="{{ url_for('quick_change', product=prod_id, type='reorder') }}">
                                <button name="reorder" class="btn btn-info" value="reorder">Reorder</button>
                                </a>
                            {% elif restock_toggle == 1 %}
                                <a href="{{ url_for('quick_change', product=prod_id, type='restock') }}">
                                <button name="restock" class="btn btn-primary" value="full-restock">Restock</button>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>


                </div>
        {% endfor %}
        </div>
    {% endif %}
    </div>
</div>
{% endblock %}
